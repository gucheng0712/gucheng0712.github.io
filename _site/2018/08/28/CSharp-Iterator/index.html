<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1"> <link rel="stylesheet" type="text/css" href="/assets/css/materialize.css"> <link rel="stylesheet" type="text/css" href="/assets/main.css"> <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"> <link rel="stylesheet" href="https://cdn.rawgit.com/konpa/devicon/df6431e323547add1b4cf45992913f15286456d3/devicon.min.css"> <title>Suzuka Site</title> </head> <body> <div class="container"> <div class="col s10"> <div class="row" style="padding:10px;"> <a id="home" class="waves-effect waves-light btn white-text darken-2 grey z-depth-4" href="/#blog"><i class="material-icons">arrow_back</i></a> </div> <h3 class="post-title" itemprop="name headline" style="text-align:center">C# Iterator</h3> <p class="post-meta"> <time datetime="2018-08-28T05:15:05-07:00" itemprop="datePublished"> Aug 28, 2018 </time> </p> <div class="post-content" itemprop="articleBody"> <p>Iterator can make you get all the elements in a sequence without caring about its type is <strong><em>Array</em></strong>, <strong><em>List</em></strong>, or other sequence structure.</p> <p>In .Net, Iterator is encapsulated by <strong><em>IEnumerator</em></strong> and their corresponding generic interfaces<strong><em>IEnumerable</em></strong></p> <p>In C#1, it has already supported iterator, which is the <strong><em>foreach</em></strong> statement. Compared with using for loop to, many times using <strong><em>foreach</em></strong> will be more easy and strightforward. when doing <strong><em>foreach</em></strong>, the compiler will compile <strong><em>foreach</em></strong> to invoke the <strong><em>GetEnumerator</em></strong> and <strong><em>MoveNext</em></strong> methods, as well as the <strong><em>Current</em></strong> property.</p> <p class="center"><img src="/assets/images/PostImages/iterator.png" alt="dot" height="80%" width="80%"/></p> <hr/> <h4 id="1-c-10-implementing-iterators-manually">1. C# 1.0: Implementing Iterators Manually</h4> <p>if we want to create a new List Type. Ignore all other details, only focus on the iterator. This List will store the values in array, and this list can set the start point of the iteration. For example, we have 5 elements. We can set start index is 2, the iteration order shoule be 2,3,4,0,1.</p> <blockquote> <p>Main Program:</p> </blockquote> <figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"> 
<span class="k">class</span> <span class="nc">MainClass</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">object</span><span class="p">[]</span> <span class="n">values</span> <span class="p">=</span> <span class="p">{</span> <span class="s">"a"</span><span class="p">,</span> <span class="s">"b"</span><span class="p">,</span> <span class="s">"c"</span><span class="p">,</span> <span class="s">"d"</span><span class="p">,</span> <span class="s">"e"</span> <span class="p">};</span>
            <span class="n">IterationSample</span> <span class="n">collection</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">IterationSample</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="m">2</span><span class="p">);</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="kt">object</span> <span class="n">x</span> <span class="k">in</span> <span class="n">collection</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span></code></pre></figure> <blockquote> <p>IterationSample Class:</p> </blockquote> <figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"> 
 <span class="k">public</span> <span class="k">class</span> <span class="nc">IterationSample</span> <span class="p">:</span> <span class="n">IEnumerable</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="n">Object</span><span class="p">[]</span> <span class="n">values</span><span class="p">;</span>
        <span class="k">public</span> <span class="n">Int32</span> <span class="n">startingPoint</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">IterationSample</span><span class="p">(</span><span class="n">Object</span><span class="p">[]</span> <span class="n">values</span><span class="p">,</span> <span class="n">Int32</span> <span class="n">startingPoint</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="n">values</span> <span class="p">=</span> <span class="n">values</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="n">startingPoint</span> <span class="p">=</span> <span class="n">startingPoint</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// In order to use "foreach" statement, this method is necessary</span>
        <span class="k">public</span> <span class="n">IEnumerator</span> <span class="nf">GetEnumerator</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">IterationSampleEnumerator</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span></code></pre></figure> <blockquote> <p>In above code, we implemented IEnumerable Interface, but we haven’t implement the GetEnumerator() method. We can use this <strong><em>IterationSample</em></strong> class to implement the Ienumerator Interface, and use different functions implements the Iterator’s Logics, but this goes against the principle of single responsibility. So we use another class to implement this.</p> </blockquote> <figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"> 
 <span class="k">public</span> <span class="k">class</span> <span class="nc">IterationSampleEnumerator</span> <span class="p">:</span> <span class="n">IEnumerator</span>
    <span class="p">{</span>
        <span class="n">IterationSample</span> <span class="n">parent</span><span class="p">;</span><span class="c1">//object to iterate</span>
        <span class="n">Int32</span> <span class="n">position</span><span class="p">;</span><span class="c1">// currentIndex Position</span>
        <span class="k">internal</span> <span class="nf">IterationSampleEnumerator</span><span class="p">(</span><span class="n">IterationSample</span> <span class="n">parent</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="n">parent</span> <span class="p">=</span> <span class="n">parent</span><span class="p">;</span>
            <span class="n">position</span> <span class="p">=</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="kt">bool</span> <span class="nf">MoveNext</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c1">//determine the current position if the last index in the list</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">position</span> <span class="p">!=</span> <span class="n">parent</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="n">Length</span><span class="p">)</span> 
            <span class="p">{</span>
                <span class="n">position</span><span class="p">++;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">position</span> <span class="p">&lt;</span> <span class="n">parent</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="kt">object</span> <span class="n">Current</span>
        <span class="p">{</span>
            <span class="k">get</span>
            <span class="p">{</span>
                <span class="c1">//not allow to access the first and the last value</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">position</span> <span class="p">==</span> <span class="p">-</span><span class="m">1</span> <span class="p">||</span> <span class="n">position</span> <span class="p">==</span> <span class="n">parent</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="n">Length</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="nf">InvalidOperationException</span><span class="p">();</span>
                <span class="p">}</span>
                
                <span class="c1">// consider the case of custom start position </span>
                <span class="n">Int32</span> <span class="n">index</span> <span class="p">=</span> <span class="n">position</span> <span class="p">+</span> <span class="n">parent</span><span class="p">.</span><span class="n">startingPoint</span><span class="p">;</span>
                <span class="n">index</span> <span class="p">=</span> <span class="n">index</span> <span class="p">%</span> <span class="n">parent</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span>
                <span class="k">return</span> <span class="n">parent</span><span class="p">.</span><span class="n">values</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Reset</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">position</span> <span class="p">=</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span></code></pre></figure> <hr/> <h4 id="2-c-20-implementing-iterators">2. C# 2.0: Implementing Iterators</h4> <p>After C# 2.0, it introduced <strong><em>iterator</em></strong>, and <strong><em>yield return</em></strong> statements. It becomes much more simplier.</p> <blockquote> <p>Main Program:</p> </blockquote> <figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"> 
<span class="k">class</span> <span class="nc">MainClass</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">object</span><span class="p">[]</span> <span class="n">values</span> <span class="p">=</span> <span class="p">{</span> <span class="s">"a"</span><span class="p">,</span> <span class="s">"b"</span><span class="p">,</span> <span class="s">"c"</span><span class="p">,</span> <span class="s">"d"</span><span class="p">,</span> <span class="s">"e"</span> <span class="p">};</span>
            <span class="n">IterationSample</span> <span class="n">collection</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">IterationSample</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="m">2</span><span class="p">);</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="kt">object</span> <span class="n">x</span> <span class="k">in</span> <span class="n">collection</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span></code></pre></figure> <blockquote> <p>IterationSample Class:</p> </blockquote> <figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"> 
 <span class="k">public</span> <span class="k">class</span> <span class="nc">IterationSample</span> <span class="p">:</span> <span class="n">IEnumerable</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="n">Object</span><span class="p">[]</span> <span class="n">values</span><span class="p">;</span>
        <span class="k">public</span> <span class="n">Int32</span> <span class="n">startingPoint</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">IterationSample</span><span class="p">(</span><span class="n">Object</span><span class="p">[]</span> <span class="n">values</span><span class="p">,</span> <span class="n">Int32</span> <span class="n">startingPoint</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="n">values</span> <span class="p">=</span> <span class="n">values</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="n">startingPoint</span> <span class="p">=</span> <span class="n">startingPoint</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// In order to use "foreach" statement, this method is necessary</span>
        <span class="k">public</span> <span class="n">IEnumerator</span> <span class="nf">GetEnumerator</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">index</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">index</span> <span class="p">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">index</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="k">yield</span> <span class="k">return</span> <span class="n">values</span><span class="p">[(</span><span class="n">index</span> <span class="p">+</span> <span class="n">startingPoint</span><span class="p">)</span> <span class="p">%</span> <span class="n">values</span><span class="p">.</span><span class="n">Length</span><span class="p">];</span>
            <span class="p">}</span>   
        <span class="p">}</span>
    <span class="p">}</span></code></pre></figure> <hr/> <blockquote> <p><strong>End –Cheng Gu</strong></p> </blockquote> </div> </div> </div> <script type="text/javascript" src="/assets/js/jquery-3.2.1.min.js"></script> <script type="text/javascript" src="/assets/js/materialize.min.js"></script> <script src="/assets/js/init.js"></script> </body> <footer class="page-footer"> <div class="footer-copyright" style="padding-left: 30px"> <i class="material-icons" style="padding-right:5px">copyright</i> <p>2018 Copyright Cheng Gu</p> </div> </footer> </html>