<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1"> <link rel="stylesheet" type="text/css" href="/assets/css/materialize.css"> <link rel="stylesheet" type="text/css" href="/assets/main.css"> <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"> <link rel="stylesheet" href="https://cdn.rawgit.com/konpa/devicon/df6431e323547add1b4cf45992913f15286456d3/devicon.min.css"> <title>Suzuka Site</title> </head> <body> <div class="container"> <div class="col s10"> <div class="row" style="padding:10px;"> <a id="home" class="waves-effect waves-light btn white-text darken-2 grey z-depth-4" href="/#blog"><i class="material-icons">arrow_back</i></a> </div> <h3 class="post-title" itemprop="name headline" style="text-align:center">Observer Pattern in Delegate and Non-Delegate</h3> <p class="post-meta"> <time datetime="2018-09-15T18:00:05-07:00" itemprop="datePublished"> Sep 16, 2018 </time> </p> <div class="post-content" itemprop="articleBody"> <p>Use observer pattern to implement A cat and few mice. When cat comes all the mices are running away.</p> <hr/> <h4 id="1-normal-ways-violates-the-open-closed-principle">1. Normal ways (Violates the Open Closed Principle)</h4> <p><img src="/assets/images/PostImages/Normal.png" alt="dot" height="50%" width="50%"/></p> <blockquote> <p>Code:</p> </blockquote> <figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"> 
    <span class="k">public</span> <span class="k">class</span> <span class="nc">Normal</span> <span class="p">:</span> <span class="n">MonoBehaviour</span>
    <span class="p">{</span>
        <span class="n">Cat</span> <span class="n">ws</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Cat</span><span class="p">();</span>
        <span class="n">MouseA</span> <span class="n">a</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MouseA</span><span class="p">();</span>
        <span class="n">MouseB</span> <span class="n">b</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MouseB</span><span class="p">();</span>
        <span class="n">MouseC</span> <span class="n">c</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MouseC</span><span class="p">();</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">Update</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">Input</span><span class="p">.</span><span class="nf">GetKeyDown</span><span class="p">(</span><span class="n">KeyCode</span><span class="p">.</span><span class="n">Space</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">ws</span><span class="p">.</span><span class="nf">CatComing</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
<span class="p">==================================</span><span class="n">Class</span> <span class="n">Division</span><span class="p">================================</span>
    <span class="k">class</span> <span class="nc">Cat</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">CatComing</span><span class="p">(</span><span class="n">MouseA</span> <span class="n">a</span><span class="p">,</span> <span class="n">MouseB</span> <span class="n">b</span><span class="p">,</span> <span class="n">MouseC</span> <span class="n">c</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">"Cat is coming"</span><span class="p">);</span>
            <span class="n">a</span><span class="p">.</span><span class="nf">RunAway</span><span class="p">();</span>
            <span class="n">b</span><span class="p">.</span><span class="nf">RunAway</span><span class="p">();</span>
            <span class="n">c</span><span class="p">.</span><span class="nf">RunAway</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
<span class="p">==================================</span><span class="n">Class</span> <span class="n">Division</span><span class="p">================================</span>
    <span class="k">class</span> <span class="nc">MouseA</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">RunAway</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">"Mouse A Run away"</span><span class="p">);</span>
        <span class="p">}</span>

    <span class="p">}</span>
    
<span class="p">==================================</span><span class="n">Class</span> <span class="n">Division</span><span class="p">================================</span>
    <span class="k">class</span> <span class="nc">MouseB</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">RunAway</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">"Mouse B Run away"</span><span class="p">);</span>
        <span class="p">}</span>

    <span class="p">}</span>
    
<span class="p">==================================</span><span class="n">Class</span> <span class="n">Division</span><span class="p">================================</span>
    <span class="k">class</span> <span class="nc">MouseC</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">RunAway</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">"Mouse C Run away"</span><span class="p">);</span>
        <span class="p">}</span>

    <span class="p">}</span></code></pre></figure> <hr/> <h4 id="2-observerpattern-complex-but-often-used-in-big-framework">2. ObserverPattern (Complex but often used in big framework)</h4> <p><img src="/assets/images/PostImages/OB.png" alt="dot" height="50%" width="50%"/></p> <blockquote> <p>Code:</p> </blockquote> <figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"> 
    <span class="k">public</span> <span class="k">class</span> <span class="nc">ObserverPattern</span> <span class="p">:</span> <span class="n">MonoBehaviour</span>
    <span class="p">{</span>
        <span class="n">Cat</span> <span class="n">cat</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Cat</span><span class="p">();</span>

        <span class="k">void</span> <span class="nf">Start</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">MouseA</span> <span class="n">mouseA</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MouseA</span><span class="p">(</span><span class="n">cat</span><span class="p">);</span>
            <span class="n">MouseB</span> <span class="n">mouseB</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MouseB</span><span class="p">(</span><span class="n">cat</span><span class="p">);</span>
            <span class="n">MouseC</span> <span class="n">mouseC</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MouseC</span><span class="p">(</span><span class="n">cat</span><span class="p">);</span>
            <span class="n">cat</span><span class="p">.</span><span class="nf">AddObserver</span><span class="p">(</span><span class="n">mouseA</span><span class="p">);</span>
            <span class="n">cat</span><span class="p">.</span><span class="nf">AddObserver</span><span class="p">(</span><span class="n">mouseB</span><span class="p">);</span>
            <span class="n">cat</span><span class="p">.</span><span class="nf">AddObserver</span><span class="p">(</span><span class="n">mouseC</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">Update</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">Input</span><span class="p">.</span><span class="nf">GetKeyDown</span><span class="p">(</span><span class="n">KeyCode</span><span class="p">.</span><span class="n">Space</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">cat</span><span class="p">.</span><span class="nf">CatComing</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>

    <span class="p">}</span>
    
<span class="p">==================================</span><span class="n">Class</span> <span class="n">Division</span><span class="p">================================</span>
    <span class="k">abstract</span> <span class="k">class</span> <span class="nc">Subject</span>
    <span class="p">{</span>
        <span class="n">List</span><span class="p">&lt;</span><span class="n">Observer</span><span class="p">&gt;</span> <span class="n">m_observers</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Observer</span><span class="p">&gt;();</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">AddObserver</span><span class="p">(</span><span class="n">Observer</span> <span class="n">ob</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">m_observers</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">ob</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">RemoveObserver</span><span class="p">(</span><span class="n">Observer</span> <span class="n">ob</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">m_observers</span><span class="p">.</span><span class="nf">Remove</span><span class="p">(</span><span class="n">ob</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">NotifyObserver</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">o</span> <span class="k">in</span> <span class="n">m_observers</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">o</span><span class="p">.</span><span class="nf">Update</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="p">==================================</span><span class="n">Class</span> <span class="n">Division</span><span class="p">================================</span>
    <span class="k">class</span> <span class="nc">Cat</span> <span class="p">:</span> <span class="n">Subject</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">CatComing</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">"Cat is Comming"</span><span class="p">);</span>
            <span class="nf">NotifyObserver</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="p">==================================</span><span class="n">Class</span> <span class="n">Division</span><span class="p">================================</span>
    <span class="k">abstract</span> <span class="k">class</span> <span class="nc">Observer</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">abstract</span> <span class="k">void</span> <span class="nf">Update</span><span class="p">();</span>
    <span class="p">}</span>

<span class="p">==================================</span><span class="n">Class</span> <span class="n">Division</span><span class="p">================================</span>
    <span class="k">class</span> <span class="nc">MouseA</span> <span class="p">:</span> <span class="n">Observer</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="n">Cat</span> <span class="n">cat</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">MouseA</span><span class="p">(</span><span class="n">Cat</span> <span class="n">_cat</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">cat</span> <span class="p">=</span> <span class="n">_cat</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">Update</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="nf">RunAway</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">RunAway</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">"MouseA is run away"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="p">==================================</span><span class="n">Class</span> <span class="n">Division</span><span class="p">================================</span>
    <span class="k">class</span> <span class="nc">MouseB</span> <span class="p">:</span> <span class="n">Observer</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="n">Cat</span> <span class="n">cat</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">MouseB</span><span class="p">(</span><span class="n">Cat</span> <span class="n">_cat</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">cat</span> <span class="p">=</span> <span class="n">_cat</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">Update</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="nf">RunAway</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">RunAway</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">"MouseB is run away"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
<span class="p">==================================</span><span class="n">Class</span> <span class="n">Division</span><span class="p">================================</span>
    <span class="k">class</span> <span class="nc">MouseC</span> <span class="p">:</span> <span class="n">Observer</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="n">Cat</span> <span class="n">cat</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">MouseC</span><span class="p">(</span><span class="n">Cat</span> <span class="n">_cat</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">cat</span> <span class="p">=</span> <span class="n">_cat</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">Update</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="nf">RunAway</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">RunAway</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">"MouseC is run away"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span></code></pre></figure> <p>[ObserverPattern with multiple Subjects]</p> <hr/> <h4 id="3-observer-pattern-by-using-c-event-simple-and-neat">3. Observer Pattern By using C# Event (Simple and Neat)</h4> <p><img src="/assets/images/PostImages/OB_Event.png" alt="dot" height="50%" width="50%"/></p> <blockquote> <p>Code:</p> </blockquote> <figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"> 
    <span class="k">public</span> <span class="k">class</span> <span class="nc">ObserverPattern_Delegate</span> <span class="p">:</span> <span class="n">MonoBehaviour</span>
    <span class="p">{</span>
        <span class="n">Cat</span> <span class="n">cat</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Cat</span><span class="p">();</span>
        <span class="n">MouseA</span> <span class="n">mouseA</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MouseA</span><span class="p">();</span>
        <span class="n">MouseB</span> <span class="n">mouseB</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MouseB</span><span class="p">();</span>
        <span class="n">MouseC</span> <span class="n">mouseC</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MouseC</span><span class="p">();</span>


        <span class="k">private</span> <span class="k">void</span> <span class="nf">Start</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">cat</span><span class="p">.</span><span class="n">CatComeEvent</span> <span class="p">+=</span> <span class="n">mouseA</span><span class="p">.</span><span class="n">RunAway</span><span class="p">;</span>
            <span class="n">cat</span><span class="p">.</span><span class="n">CatComeEvent</span> <span class="p">+=</span> <span class="n">mouseB</span><span class="p">.</span><span class="n">RunAway</span><span class="p">;</span>
            <span class="n">cat</span><span class="p">.</span><span class="n">CatComeEvent</span> <span class="p">+=</span> <span class="n">mouseC</span><span class="p">.</span><span class="n">RunAway</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">Update</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">Input</span><span class="p">.</span><span class="nf">GetKeyDown</span><span class="p">(</span><span class="n">KeyCode</span><span class="p">.</span><span class="n">Space</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">cat</span><span class="p">.</span><span class="nf">CatComing</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="p">==================================</span><span class="n">Class</span> <span class="n">Division</span><span class="p">================================</span>
    <span class="k">class</span> <span class="nc">Cat</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">delegate</span> <span class="k">void</span> <span class="nf">CatComeEventHandler</span><span class="p">();</span>
        <span class="k">public</span> <span class="k">event</span> <span class="n">CatComeEventHandler</span> <span class="n">CatComeEvent</span><span class="p">;</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">CatComing</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">"Cat is Coming"</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">CatComeEvent</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="nf">CatComeEvent</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="p">==================================</span><span class="n">Class</span> <span class="n">Division</span><span class="p">================================</span>
    <span class="k">class</span> <span class="nc">MouseA</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">RunAway</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">"MouseA,Run, Cat is coming"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
<span class="p">==================================</span><span class="n">Class</span> <span class="n">Division</span><span class="p">================================</span>
    <span class="k">class</span> <span class="nc">MouseB</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">RunAway</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">"MouseB,Run, Cat is coming"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="p">==================================</span><span class="n">Class</span> <span class="n">Division</span><span class="p">================================</span>
    <span class="k">class</span> <span class="nc">MouseC</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">RunAway</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">"MouseC,Run, Cat is coming"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span></code></pre></figure> <hr/> <blockquote> <p><strong>End –Cheng Gu</strong></p> </blockquote> </div> </div> </div> <script type="text/javascript" src="/assets/js/jquery-3.2.1.min.js"></script> <script type="text/javascript" src="/assets/js/materialize.min.js"></script> <script src="/assets/js/init.js"></script> </body> <footer class="page-footer"> <div class="footer-copyright" style="padding-left: 30px"> <i class="material-icons" style="padding-right:5px">copyright</i> <p>2018 Copyright Cheng Gu</p> </div> </footer> </html>