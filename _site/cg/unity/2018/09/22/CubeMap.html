<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1 maximum-scale=1; minimum-scale=1; user-scalable=no;"> <meta name="author" content="ChengGu"> <meta name="baseurl" content=""> <title> Suzuka Site|CubeMap </title> <!-- favicon --> <link rel="shortcut icon" href="/static/assets/img/favicon.ico"> <!-- Main CSS --> <link href="/static/assets/app-20180125.min.css" rel="stylesheet"> <link href="/static/css/custom.css" rel="stylesheet"> <!-- Main Scripts --> <script src="/static/assets/app-20180125.min.js"></script> <script src="/static/assets/blog-20180125.min.js"></script> <!-- Google AdSense --> <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <script> (adsbygoogle = window.adsbygoogle || []).push({ google_ad_client: "ca-pub-6196184668650108", enable_page_level_ads: true }); </script> </head> <body id="page-top" class="landing-page"> <div class="search-tool" style="position: fixed; top: 0px ; bottom: 0px; left: 0px; right: 0px; opacity: 0.95; background-color: #111111; z-index: 9999; display: none;"> <input type="text" class="form-control search-content" id="search-content" style="position: fixed; top: 60px" placeholder="Search Blog"> <div style="position: fixed; top: 16px; right: 16px; z-index: 9999;"> <img src="/static/assets/img/search/cb-close.png" id="close-btn"/> </div> </div> <div style="position: fixed; right: 16px; bottom: 20px; z-index: 9999;"> <img src="/static/assets/img/search/cb-search.png" id="search-btn" title="Double click Ctrl"/> </div> <div class="navbar-wrapper"> <nav class="navbar navbar-default navbar-fixed-top" role="navigation"> <div class="container"> <div class="navbar-header page-scroll"> <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="/">Suzuka Site</a> </div> <div id="navbar" class="navbar-collapse collapse"> <ul class="nav navbar-nav navbar-right"> <li><a class="page-scroll" href="blog/"></a></li> <li> <a class="page-scroll" href="/blog/">Blog</a></li> <li> <a class="page-scroll" href="/unity/">Unity</a></li> <li> <a class="page-scroll" href="/ai/">AI</a></li> <li> <a class="page-scroll" href="/cg/">CG</a></li> <li> <a class="page-scroll" href="/math/">Math</a></li> <li> <a class="page-scroll" href="/data structure/">Data Structure</a></li> <li> <a class="page-scroll" href="/csharp/">C#</a></li> <li> <a class="page-scroll" href="/python/">Python</a></li> <li> <a class="page-scroll" href="/javascript/">JavaScript</a></li> <li> <a class="page-scroll" href="/game dev/">Game Dev</a></li> </ul> </div> </div> </nav> </div> <!--<link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css'>--> <!--<link rel="stylesheet" href="static/css/carousel_style.css">--> <!--<script src="static/js/carousel.js"></script>--> <div id="carouselHacked" class="carousel slide carousel-fade" data-ride="carousel"> <div class="carousel-inner" role="listbox"> <div class="item active"> <!-- Set background for slide in css --> <div class="header-back" style="background-image: url(/static/assets/img/landing/header_1.jpg);" title="first banner image"> </div> </div> <div class="item"> <div class="header-back" style="background-image: url(/static/assets/img/landing/header_2.jpg);" title=""> </div> </div> <div class="item"> <div class="header-back" style="background-image: url(/static/assets/img/landing/header_3.jpg);" title="third banner image"> </div> </div> <div class="item"> <div class="header-back" style="background-image: url(/static/assets/img/landing/header_4.jpg);" title="fourth banner image"> </div> </div> <div class="item"> <div class="header-back" style="background-image: url(/static/assets/img/landing/header_5.jpg);" title="fifth banner image"> </div> </div> <div class="item"> <div class="header-back" style="background-image: url(/static/assets/img/landing/header_6.jpg);" title="sixth banner image"> </div> </div> </div> <!-- Controls --> <a class="left carousel-control" href="#carouselHacked" role="button" data-slide="prev"> <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span> <span class="sr-only">Previous</span> </a> <a class="right carousel-control" href="#carouselHacked" role="button" data-slide="next"> <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span> <span class="sr-only">Next</span> </a> </div> <script type="text/x-mathjax-config"> MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']], processEscapes: true } }); </script> <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script> <div class="wrapper wrapper-content animated fadeInRight article"> <div class="row"> <div class="col-lg-10 col-lg-offset-1"> <div class="ibox"> <div class="ibox-content"> <div class="pull-right"> <a class="btn btn-white btn-xs" href="/cg">Cg</a> <a class="btn btn-white btn-xs" href="/unity">Unity</a> </div> <div class="text-center article-title"> <span class="text-muted"><i class="fa fa-clock-o"></i> 22 Sep 2018</span> <h1> CubeMap </h1> </div> <p>In CG, CubeMap is the way to achieve Environment Mapping. it can simulate the environment around the object, make the object be able to reflect the environment around itself.</p> <p>Cubemap includes 6 images. these images correspond to the six sides of a cube.</p> <blockquote> <p>So How to sample this Cubemap Texture?</p> </blockquote> <p>Different from sampling the 2D Texture, it needs a 3D Texture coordinate to sample a Cubemap. This 3D texture coordiate represents a 3D direction vector of a object in the world space. This Vector starts from the center of the cube, And a direction vector only represent the dir, so it can be think of infinity length, when it extend its length, eventually it will intersect with one of the cube’s six textures, the result of sampling is calculated with the intersection point. just like below image.</p> <p align="center"> <img src="/static/assets/img/blog/cubemapSampler.png" width="50%" /> </p> <blockquote> <p>Pros of using Cubemap</p> </blockquote> <ol> <li>Easy and Fast.</li> <li>Effects of Cubemap are not bad.</li> </ol> <blockquote> <p>Cons of using Cubemap</p> <ol> <li>When introducing a new object in the scene, the light source, or an object moves, we need to regenerate the cube texture.</li> <li>The Cubemap texture can not simulate the result of the multiple reflections, such as two metal ball reflection of each other.</li> </ol> </blockquote> <blockquote> <p>Therefore, we should use Cubemap texture for convex objects and do not use it for concave objects (because the concave objects reflect itself)</p> </blockquote> <hr /> <h4 id="1-reflection">1. Reflection</h4> <p>To simulate the reflection effect, we simply need to calculate the direction of the reflection by the direction of the incident ray(which is the negative view direction) and the normal direction of the surface. Finally, the reflection direction is used to sample the Cubemap texture.</p> <p align="center"> <img src="/static/assets/img/blog/reflection.png" width="50%" /> </p> <blockquote> <p>Properties:</p> </blockquote> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   	Properties
    {
        _Color("Color",Color) = (1,1,1,1)
        _ReflectColor("Reflect Color", Color) = (1,1,1,1)
        _ReflectAmount("Reflect Amount", Range(0,1)) = 1
        _Cubemap("Reflection Cubemap", Cube) = "_Skybox"{}
    }
</code></pre></div></div> <blockquote> <p>VertexShader:</p> </blockquote> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    v2f vert(a2v v)
    {
        v2f f;
        f.pos = UnityObjectToClipPos(v.vertex);
        f.worldPos = mul(unity_ObjectToWorld, v.vertex).xyz;
        f.worldNormal = mul(v.normal,unity_WorldToObject);
        f.worldViewDir = UnityWorldSpaceViewDir(f.worldPos);
        f.worldRefl = reflect(-f.worldViewDir,f.worldNormal);
        TRANSFER_SHADOW(f);
        return f;
    }
</code></pre></div></div> <blockquote> <p>FragmentShader:</p> </blockquote> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    fixed4 frag(v2f f):SV_Target
    {
        fixed3 worldNormal = normalize(f.worldNormal);
        fixed3 worldLightDir = normalize(UnityWorldSpaceLightDir(f.worldPos));
        
        fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.rgb;
        
        fixed3 diffuse = _LightColor0.rgb * _Color.rgb *max(0, dot(worldNormal,worldLightDir));
        fixed3 reflection = texCUBE(_Cubemap,f.worldRefl).rgb * _ReflectColor.rgb;
        
        UNITY_LIGHT_ATTENUATION(atten, f, f.worldPos);
        
        fixed3 color = ambient+lerp(diffuse,reflection,_ReflectAmount)*atten;
        
        return fixed4(color,1.0);
    }
</code></pre></div></div> <hr /> <h4 id="2-refraction">2. Refraction</h4> <p>Refraction: When light rays from one medium, such as air, are deflected into another, such as glass, the direction of propagation generally changes, this phenomenon is called refraction.</p> <blockquote> <p>Snell’s Law:</p> </blockquote> <p><img src="/static/assets/img/blog/SnellLaw.png" width="15%" /></p> <blockquote> <p>n1 and n2 are the medium’s percentage of refraction.</p> </blockquote> <p><img src="/static/assets/img/blog/refractionDefinition.png" width="30%" /></p> <blockquote> <p>Result:</p> </blockquote> <p class="center"><img src="/assets/images/PostImages/refraction.png" alt="dot" height="50%" width="50%" /></p> <p align="center"> <img src="/static/assets/img/blog/refraction.png" width="50%" /> </p> <blockquote> <p>Properties:</p> </blockquote> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        _Color("Color",Color) = (1,1,1,1)
        _RefractColor("Reflect Color", Color) = (1,1,1,1)
        _RefractAmount("Reflect Amount", Range(0,1)) = 1
        
        // The Percentage of Differnet Medium
        // eg: Refraction Percentage of Air/ Refraction Percentage of Glass
        _RefractRatio("Refract Ratio",Range(0.1,1)) = 0.5  
        _Cubemap("Reflection Cubemap", Cube) = "_Skybox"{}
</code></pre></div></div> <blockquote> <p>VertexShader:</p> </blockquote> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        v2f vert(a2v v)
        {
            v2f f;
            f.pos = UnityObjectToClipPos(v.vertex);
            f.worldPos = mul(unity_ObjectToWorld, v.vertex).xyz;
            f.worldNormal = mul(v.normal,unity_WorldToObject);
            f.worldViewDir = UnityWorldSpaceViewDir(f.worldPos);
            f.worldRefr = refract(-normalize(f.worldViewDir),normalize(f.worldNormal),_RefractRatio);
            TRANSFER_SHADOW(f);
            return f;
        }
</code></pre></div></div> <blockquote> <p>FragmentShader:</p> </blockquote> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        fixed4 frag(v2f f):SV_Target
        {
            fixed3 worldNormal = normalize(f.worldNormal);
            fixed3 worldLightDir = normalize(UnityWorldSpaceLightDir(f.worldPos));
            
            fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.rgb;
            
            fixed3 diffuse = _LightColor0.rgb * _Color.rgb *max(0, dot(worldNormal,worldLightDir));
            fixed3 refraction = texCUBE(_Cubemap,f.worldRefr).rgb * _RefractColor.rgb;
            
            UNITY_LIGHT_ATTENUATION(atten, f, f.worldPos);
            
            fixed3 color = ambient+lerp(diffuse,refraction,_RefractAmount)*atten;
            
            return fixed4(color,1.0);
        }
</code></pre></div></div> <hr /> <h4 id="3-fresnel-reflection">3. Fresnel Reflection</h4> <p>Fresnel Reflection Represents a Optical Phenomenon. When light hits the surface of an object, some parts occur reflection, some parts goes into the inside of the object, or occur refraction or scattering.</p> <p>For example, When you stand by the lake and look down at the water at your feet, you will find that the water is almost transparent. You can see the small fish and stones directly. But when you look up at the water in the distance, you will find that you can hardly see the underwater scene, but only the environment that reflects the water.</p> <blockquote> <p>A Famous Equation is called Schlick’s Approximation</p> </blockquote> <p><img src="/static/assets/img/blog/schlick.png" width="25%" /></p> <p>In this equation, F0 is a reflection coefficient, which is used to control the magnitude of the reflection, v is the view dir, n is normal dir.</p> <p align="center"> <img src="/static/assets/img/blog/schlickPP.png" width="50%" /> </p> <blockquote> <p>Properties:</p> </blockquote> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        _Color("Color",Color) = (1,1,1,1)
        _FresnelScale("Fresnel Scale",Range(0,1))=0.5
        _Cubemap("Reflection Cubemap", Cube) = "_Skybox"{}
</code></pre></div></div> <blockquote> <p>VertexShader:</p> </blockquote> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        v2f vert(a2v v)
        {
            v2f f;
            f.pos = UnityObjectToClipPos(v.vertex);
            f.worldPos = mul(unity_ObjectToWorld, v.vertex).xyz;
            f.worldNormal = mul(v.normal,unity_WorldToObject);
            f.worldViewDir = UnityWorldSpaceViewDir(f.worldPos);
            f.worldRefl = reflect(-f.worldViewDir,f.worldNormal);
            TRANSFER_SHADOW(f);
            return f;
        }
</code></pre></div></div> <blockquote> <p>FragmentShader:</p> </blockquote> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        fixed4 frag(v2f f):SV_Target
        {
            fixed3 worldNormal = normalize(f.worldNormal);
            fixed3 worldLightDir = normalize(UnityWorldSpaceLightDir(f.worldPos));
            fixed3 worldViewDir = normalize(f.worldViewDir);
            
            fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.rgb;
            
            fixed3 diffuse = _LightColor0.rgb * _Color.rgb *max(0, dot(worldNormal,worldLightDir));
            fixed3 reflection = texCUBE(_Cubemap,f.worldRefl).rgb;
            
            fixed fesnel = _FresnelScale+(1-_FresnelScale)*pow(1-dot(worldViewDir,worldNormal),5);
            
            UNITY_LIGHT_ATTENUATION(atten, f, f.worldPos);
            
            fixed3 color = ambient+lerp(diffuse, reflection, fesnel) * atten;
            
            return fixed4(color,1.0);
        }   
</code></pre></div></div> <hr /> <blockquote> <p><strong>End –Cheng Gu</strong></p> </blockquote> <hr> <div class="row"> <div class="col-md-6"> <h5 style="display: inline;">Tags:</h5> <button class="btn btn-white btn-xs" type="button">Unity</button> <button class="btn btn-white btn-xs" type="button">Shader</button> <button class="btn btn-white btn-xs" type="button">Math</button> <button class="btn btn-white btn-xs" type="button">CG</button> </div> <div class="col-md-6"> <div class="small text-right"> <div> </div> </div> </div> </div> <br> <div class="row"> <div class="col-lg-12"> <!-- donate --> <br> <!-- share --> <div class="a2a_kit a2a_kit_size_32 a2a_default_style"> <a class="a2a_dd" href="https://www.addtoany.com/share"></a> <a class="a2a_button_facebook"></a> <a class="a2a_button_twitter"></a> <a class="a2a_button_google_plus"></a> <a class="a2a_button_linkedin"></a> <a class="a2a_button_email"></a> <a class="a2a_button_wechat"></a> <a class="a2a_button_sina_weibo"></a> <a class="a2a_button_pocket"></a> </div> <script> var a2a_config = a2a_config || {}; a2a_config.color_main = "D7E5ED"; a2a_config.color_border = "AECADB"; a2a_config.color_link_text = "333333"; a2a_config.color_link_text_hover = "333333"; </script> <script async src="https://static.addtoany.com/menu/page.js"></script> <br> <!-- comment --> </div> </div> </div> </div> </div> </div> </div> <!-- Google analytics --> <!-- GrowingIO --> </body> </html>
