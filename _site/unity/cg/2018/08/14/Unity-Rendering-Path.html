<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1 maximum-scale=1; minimum-scale=1; user-scalable=no;"> <meta name="author" content="ChengGu"> <meta name="baseurl" content=""> <title> Suzuka Site|Unity Rendering Path (CG) </title> <!-- favicon --> <link rel="shortcut icon" href="/static/assets/img/favicon.ico"> <!-- Main CSS --> <link href="/static/assets/app-20180125.min.css" rel="stylesheet"> <link href="/static/css/custom.css" rel="stylesheet"> <!-- Main Scripts --> <script src="/static/assets/app-20180125.min.js"></script> <script src="/static/assets/blog-20180125.min.js"></script> <!-- Google AdSense --> <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <script> (adsbygoogle = window.adsbygoogle || []).push({ google_ad_client: "ca-pub-6196184668650108", enable_page_level_ads: true }); </script> </head> <body id="page-top" class="landing-page"> <div class="search-tool" style="position: fixed; top: 0px ; bottom: 0px; left: 0px; right: 0px; opacity: 0.95; background-color: #111111; z-index: 9999; display: none;"> <input type="text" class="form-control search-content" id="search-content" style="position: fixed; top: 60px" placeholder="Search Blog"> <div style="position: fixed; top: 16px; right: 16px; z-index: 9999;"> <img src=" /static/assets/img/search/cb-close.png " id="close-btn" /> </div> </div> <div style="position: fixed; right: 16px; bottom: 20px; z-index: 9999;"> <img src=" /static/assets/img/search/cb-search.png " id="search-btn" title="Double click Ctrl" /> </div> <div class="navbar-wrapper"> <nav class="navbar navbar-default navbar-fixed-top" role="navigation"> <div class="container"> <div class="navbar-header page-scroll"> <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href=" / ">Suzuka Site</a> </div> <div id="navbar" class="navbar-collapse collapse"> <ul class="nav navbar-nav navbar-right"> <li><a class="page-scroll" href=" blog/ "></a></li> <li> <a class="page-scroll" href="/blog/">Blog</a></li> <li> <a class="page-scroll" href="/unity/">Unity</a></li> <li> <a class="page-scroll" href="/ai/">AI</a></li> <li> <a class="page-scroll" href="/cg/">CG</a></li> <li> <a class="page-scroll" href="/math/">Math</a></li> <li> <a class="page-scroll" href="/data structure/">Data Structure</a></li> <li> <a class="page-scroll" href="/csharp/">C#</a></li> <li> <a class="page-scroll" href="/python/">Python</a></li> <li> <a class="page-scroll" href="/javascript/">JavaScript</a></li> <li> <a class="page-scroll" href="/dev journal/">Dev Journal</a></li> </ul> </div> </div> </nav> </div> <!--<link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css'>--> <!--<link rel="stylesheet" href="static/css/carousel_style.css">--> <!--<script src="static/js/carousel.js"></script>--> <div id="carouselHacked" class="carousel slide carousel-fade" data-ride="carousel"> <div class="carousel-inner" role="listbox"> <div class="item active"> <!-- Set background for slide in css --> <div class="header-back" style="background-image: url(/static/assets/img/landing/header_1.jpg);" title="first banner image"> </div> </div> <div class="item"> <div class="header-back" style="background-image: url(/static/assets/img/landing/header_2.jpg);" title=""> </div> </div> <div class="item"> <div class="header-back" style="background-image: url(/static/assets/img/landing/header_3.jpg);" title="third banner image"> </div> </div> <div class="item"> <div class="header-back" style="background-image: url(/static/assets/img/landing/header_4.jpg);" title="fourth banner image"> </div> </div> <div class="item"> <div class="header-back" style="background-image: url(/static/assets/img/landing/header_5.jpg);" title="fifth banner image"> </div> </div> <div class="item"> <div class="header-back" style="background-image: url(/static/assets/img/landing/header_6.jpg);" title="sixth banner image"> </div> </div> </div> <!-- Controls --> <a class="left carousel-control" href="#carouselHacked" role="button" data-slide="prev"> <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span> <span class="sr-only">Previous</span> </a> <a class="right carousel-control" href="#carouselHacked" role="button" data-slide="next"> <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span> <span class="sr-only">Next</span> </a> </div> <script type="text/x-mathjax-config"> MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']], processEscapes: true } }); </script> <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script> <div class="wrapper wrapper-content animated fadeInRight article"> <div class="row"> <div class="col-lg-10 col-lg-offset-1"> <div class="ibox"> <div class="ibox-content"> <div class="pull-right"> <a class="btn btn-white btn-xs" href="/unity">Unity</a> <a class="btn btn-white btn-xs" href="/cg">Cg</a> </div> <div class="text-center article-title"> <span class="text-muted"><i class="fa fa-clock-o"></i> 14 Aug 2018</span> <h1> Unity Rendering Path (CG) </h1> </div> <div class="ibox-postpadding"> <p>Unity support many kinds of rendering paths. For now there are <code class="highlighter-rouge">three</code> types of rendering path in Unity: <code class="highlighter-rouge">forward</code>, <code class="highlighter-rouge">deferred</code>, and <code class="highlighter-rouge">vertex lit (almost never use)</code> rendering path.</p> <blockquote> <p><em>An example of setting rendering path <code class="highlighter-rouge">in Unity Shader</code></em></p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Pass</span>
<span class="p">{</span>
    <span class="n">Tags</span><span class="p">{</span> <span class="s">"LightMode"</span> <span class="p">=</span> <span class="s">"ForwardBase"</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div> </div> </blockquote> <blockquote> <p><strong>The Below Table shows the <code class="highlighter-rouge">Common</code> Rendering Path Option for LightMode Tag in Unity Shader</strong></p> </blockquote> <table rules="groups"> <thead> <tr> <th style="text-align: left">Tag Name</th> <th style="text-align: center">       </th> <th>Description</th> </tr> </thead> <tbody> <tr> <td style="text-align: left"><strong>Always</strong></td> <td style="text-align: center"> </td> <td>This Pass will be rendered in any rendering path, but it will not calculate any lighting</td> </tr> </tbody> <tbody> <tr> <td style="text-align: left"><strong>ForwardBase</strong></td> <td style="text-align: center"> </td> <td>Used for forward rendering. The Pass will calculate the <strong>environmetal light, directional light, per-vertex /Spherical Harmonics(SH) light source</strong>, and Lightmaps</td> </tr> </tbody> <tbody> <tr> <td style="text-align: left"><strong>ForwardAdd</strong></td> <td style="text-align: center"> </td> <td>Used for forward rendering. The Pass will calculate <strong>additional per-pixel light source</strong>, every Pass corresponding one light source</td> </tr> </tbody> <tbody> <tr> <td style="text-align: left"><strong>Deferred</strong></td> <td style="text-align: center"> </td> <td>Used for deferred rendering. This Pass will render <strong>G-Buffer(includes color, normal, Buffer in world space)</strong></td> </tr> </tbody> <tbody> <tr> <td style="text-align: left"><strong>ShadowCaster</strong></td> <td style="text-align: center"> </td> <td>Render the object’s depth info into the <strong>shaowmap or a depth map</strong></td> </tr> </tbody> </table> <hr /> <h2 id="1-forward-rendering-path"><strong>1. Forward Rendering Path</strong></h2> <p align="center"> <img src="/static/assets/img/blog/fwdRendering.png" width="50%" /> </p> <p>For each forward rendering, we need to <code class="highlighter-rouge">render</code> the rendering primitive of the object and <code class="highlighter-rouge">calculate</code> the data of two buffers (<code class="highlighter-rouge">color</code> buffer and <code class="highlighter-rouge">depth</code> buffer). We use the <code class="highlighter-rouge">depth buffer</code> to <code class="highlighter-rouge">determine</code> <code class="highlighter-rouge">if a fragment is visible</code> and <code class="highlighter-rouge">update</code> the color value of the color buffer <code class="highlighter-rouge">if it is visible</code>.</p> <blockquote> <p><strong>Pseudo code</strong>:</p> </blockquote> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Pass</span>
<span class="p">{</span>
    <span class="k">for</span><span class="p">(</span><span class="n">each</span> <span class="n">primitive</span> <span class="k">in</span> <span class="k">this</span> <span class="n">model</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">for</span><span class="p">(</span><span class="n">each</span> <span class="n">fragment</span> <span class="n">covered</span> <span class="k">by</span> <span class="k">this</span> <span class="n">primitive</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="n">failed</span> <span class="k">in</span> <span class="n">depth</span> <span class="n">test</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">discard</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="n">float4</span> <span class="n">color</span> <span class="p">=</span> <span class="nf">Shading</span><span class="p">(</span><span class="n">materialInfo</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">normal</span><span class="p">,</span> <span class="n">lightDir</span><span class="p">,</span> <span class="n">viewDir</span><span class="p">);</span>

                <span class="nf">WriteFrameBuffer</span><span class="p">(</span><span class="n">fragment</span><span class="p">,</span> <span class="n">color</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span> 
</code></pre></div></div> <hr /> <h2 id="2-deferred-rendering-path"><strong>2. Deferred Rendering Path</strong></h2> <p align="center"> <img src="/static/assets/img/blog/deferredrendering.png" width="50%" /> </p> <p><code class="highlighter-rouge">Deferred Rendering</code> mainly includes <code class="highlighter-rouge">two Pass</code>. The <code class="highlighter-rouge">first</code> Pass, we <code class="highlighter-rouge">don’t</code> do any lighting calculations, and <code class="highlighter-rouge">only</code> calculate which fragment in the screen is <code class="highlighter-rouge">visible</code> through <code class="highlighter-rouge">depth buffer</code>. <code class="highlighter-rouge">After</code> finding a fragment is visible, it will <code class="highlighter-rouge">store</code> the data into the <code class="highlighter-rouge">G-Buffer</code>. Then, in the <code class="highlighter-rouge">second</code> Pass, it will <code class="highlighter-rouge">use</code> the data of fragment in the G-Buffer to do the lighting calculation.</p> <blockquote> <p><strong>Pseudo code</strong>:</p> </blockquote> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PassOne</span> <span class="c1">// Store fragment data into G-Buffer</span>
<span class="p">{</span>
    <span class="k">for</span><span class="p">(</span><span class="n">each</span> <span class="n">primitive</span> <span class="k">in</span> <span class="k">this</span> <span class="n">model</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">for</span><span class="p">(</span><span class="n">each</span> <span class="n">fragment</span> <span class="n">covered</span> <span class="k">by</span> <span class="k">this</span> <span class="n">primitive</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="n">failed</span> <span class="k">in</span> <span class="n">depth</span> <span class="n">test</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">discard</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="nf">WriteGBuffer</span><span class="p">(</span><span class="n">materialInfo</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">normal</span><span class="p">,</span> <span class="n">lightDir</span><span class="p">,</span> <span class="n">viewDir</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="n">PassTwo</span> <span class="c1">// Calcaulate Lighting by using the data in G-Buffer</span>
<span class="p">{</span>
    <span class="k">for</span><span class="p">(</span><span class="n">each</span> <span class="n">pixel</span> <span class="k">in</span> <span class="n">the</span> <span class="n">screen</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">the</span> <span class="n">pixel</span> <span class="k">is</span> <span class="n">valid</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nf">readGBuffer</span><span class="p">(</span><span class="n">pixel</span><span class="p">,</span> <span class="n">materialInfo</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">normal</span><span class="p">,</span> <span class="n">lightDir</span><span class="p">,</span> <span class="n">viewDir</span><span class="p">);</span>
            <span class="n">float4</span> <span class="n">color</span> <span class="p">=</span> <span class="nf">Shading</span><span class="p">(</span><span class="n">materialInfo</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">normal</span><span class="p">,</span> <span class="n">lightDir</span><span class="p">,</span> <span class="n">viewDir</span><span class="p">);</span>
            <span class="nf">WriteFrameBuffer</span><span class="p">(</span><span class="n">pixel</span><span class="p">,</span> <span class="n">color</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span> 
</code></pre></div></div> <hr /> <h3 id="2-forward-rendering-vs-deferred-rendering">2. <strong>Forward Rendering vs Deferred Rendering</strong></h3> <blockquote> <p>Normally we will use <code class="highlighter-rouge">Forward Rendering</code>, but when the scene has <code class="highlighter-rouge">too many light sources</code>, the <code class="highlighter-rouge">performance</code> of Forward Rendering <code class="highlighter-rouge">drops</code> dramatically.</p> </blockquote> <blockquote> <p>For example, if we place multiple light sources in an area in the Unity Scene, and these light source areas overlap and influence with each other. In order to get the final lighting effects, we need to perform multiple Pass for each object in the area to calculate the lighting result of different light source to this object, finally, blend these results in the color buffer to get the final lighting. Therefore, every time when we call a Pass we need to render the object again, but many calculations actually is repeat.</p> </blockquote> <blockquote> <p>Deferred Rendering can solve this problem because it <code class="highlighter-rouge">not only</code> uses <code class="highlighter-rouge">color buffer</code>, and <code class="highlighter-rouge">depth buffer</code>, it also use an additional buffer called <code class="highlighter-rouge">G-Buffer</code> (Geometry- Buffer). G-Buffer <code class="highlighter-rouge">stores</code> the information of the surface we care (normally it means the surface which is the closest to camera), such as the surface’s Normal, Position, Material Properties used for illumination calculation, etc.</p> </blockquote> <hr /> <blockquote> <p><strong>End –Cheng Gu</strong></p> </blockquote> </div> <hr> <div class="row"> <div class="col-md-6"> <h5 style="display: inline;">Tags:</h5> <button class="btn btn-white btn-xs" type="button">Unity</button> <button class="btn btn-white btn-xs" type="button">CG</button> </div> <div class="col-md-6"> <div class="small text-right"> <div> </div> </div> </div> </div> <br> <div class="row"> <div class="col-lg-12"> <!-- donate --> <br> <!-- share --> <div class="a2a_kit a2a_kit_size_32 a2a_default_style"> <a class="a2a_dd" href="https://www.addtoany.com/share"></a> <a class="a2a_button_facebook"></a> <a class="a2a_button_twitter"></a> <a class="a2a_button_google_plus"></a> <a class="a2a_button_linkedin"></a> <a class="a2a_button_email"></a> <a class="a2a_button_wechat"></a> <a class="a2a_button_sina_weibo"></a> <a class="a2a_button_pocket"></a> </div> <script> var a2a_config = a2a_config || {}; a2a_config.color_main = "D7E5ED"; a2a_config.color_border = "AECADB"; a2a_config.color_link_text = "333333"; a2a_config.color_link_text_hover = "333333"; </script> <script async src="https://static.addtoany.com/menu/page.js"></script> <br> <!-- comment --> </div> </div> </div> </div> </div> </div> </div> <!-- Google analytics --> <!-- GrowingIO --> </body> </html>
