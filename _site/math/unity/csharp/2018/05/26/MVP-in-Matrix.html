<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1 maximum-scale=1; minimum-scale=1; user-scalable=no;"> <meta name="author" content="ChengGu"> <meta name="baseurl" content=""> <title> Suzuka Site|Matrix MVP </title> <!-- favicon --> <link rel="shortcut icon" href="/static/assets/img/favicon.ico"> <!-- Main CSS --> <link href="/static/assets/app-20180125.min.css" rel="stylesheet"> <link href="/static/css/custom.css" rel="stylesheet"> <!-- Main Scripts --> <script src="/static/assets/app-20180125.min.js"></script> <script src="/static/assets/blog-20180125.min.js"></script> <!-- Google AdSense --> <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <script> (adsbygoogle = window.adsbygoogle || []).push({ google_ad_client: "ca-pub-6196184668650108", enable_page_level_ads: true }); </script> </head> <body id="page-top" class="landing-page"> <div class="search-tool" style="position: fixed; top: 0px ; bottom: 0px; left: 0px; right: 0px; opacity: 0.95; background-color: #111111; z-index: 9999; display: none;"> <input type="text" class="form-control search-content" id="search-content" style="position: fixed; top: 60px" placeholder="Search Blog"> <div style="position: fixed; top: 16px; right: 16px; z-index: 9999;"> <img src=" /static/assets/img/search/cb-close.png " id="close-btn" /> </div> </div> <div style="position: fixed; right: 16px; bottom: 20px; z-index: 9999;"> <img src=" /static/assets/img/search/cb-search.png " id="search-btn" title="Double click Ctrl" /> </div> <div class="navbar-wrapper"> <nav class="navbar navbar-default navbar-fixed-top" role="navigation"> <div class="container"> <div class="navbar-header page-scroll"> <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href=" / ">Suzuka Site</a> </div> <div id="navbar" class="navbar-collapse collapse"> <ul class="nav navbar-nav navbar-right"> <li><a class="page-scroll" href=" blog/ "></a></li> <li> <a class="page-scroll" href="/blog/">Blog</a></li> <li> <a class="page-scroll" href="/unity/">Unity</a></li> <li> <a class="page-scroll" href="/ai/">AI</a></li> <li> <a class="page-scroll" href="/cg/">CG</a></li> <li> <a class="page-scroll" href="/math/">Math</a></li> <li> <a class="page-scroll" href="/data structure/">Data Structure</a></li> <li> <a class="page-scroll" href="/csharp/">C#</a></li> <li> <a class="page-scroll" href="/python/">Python</a></li> <li> <a class="page-scroll" href="/javascript/">JavaScript</a></li> <li> <a class="page-scroll" href="/dev journal/">Dev Journal</a></li> </ul> </div> </div> </nav> </div> <!--<link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css'>--> <!--<link rel="stylesheet" href="static/css/carousel_style.css">--> <!--<script src="static/js/carousel.js"></script>--> <div id="carouselHacked" class="carousel slide carousel-fade" data-ride="carousel"> <div class="carousel-inner" role="listbox"> <div class="item active"> <!-- Set background for slide in css --> <div class="header-back" style="background-image: url(/static/assets/img/landing/header_1.jpg);" title="first banner image"> </div> </div> <div class="item"> <div class="header-back" style="background-image: url(/static/assets/img/landing/header_2.jpg);" title=""> </div> </div> <div class="item"> <div class="header-back" style="background-image: url(/static/assets/img/landing/header_3.jpg);" title="third banner image"> </div> </div> <div class="item"> <div class="header-back" style="background-image: url(/static/assets/img/landing/header_4.jpg);" title="fourth banner image"> </div> </div> <div class="item"> <div class="header-back" style="background-image: url(/static/assets/img/landing/header_5.jpg);" title="fifth banner image"> </div> </div> <div class="item"> <div class="header-back" style="background-image: url(/static/assets/img/landing/header_6.jpg);" title="sixth banner image"> </div> </div> </div> <!-- Controls --> <a class="left carousel-control" href="#carouselHacked" role="button" data-slide="prev"> <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span> <span class="sr-only">Previous</span> </a> <a class="right carousel-control" href="#carouselHacked" role="button" data-slide="next"> <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span> <span class="sr-only">Next</span> </a> </div> <script type="text/x-mathjax-config"> MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']], processEscapes: true } }); </script> <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script> <div class="wrapper wrapper-content animated fadeInRight article"> <div class="row"> <div class="col-lg-10 col-lg-offset-1"> <div class="ibox"> <div class="ibox-content"> <div class="pull-right"> <a class="btn btn-white btn-xs" href="/math">Math</a> <a class="btn btn-white btn-xs" href="/unity">Unity</a> <a class="btn btn-white btn-xs" href="/csharp">Csharp</a> </div> <div class="text-center article-title"> <span class="text-muted"><i class="fa fa-clock-o"></i> 26 May 2018</span> <h1> Matrix MVP </h1> </div> <div class="ibox-postpadding"> <p align="center"> <img src="/static/assets/img/blog/mvp_transformation.png" width="90%" /> </p> <p>MVP Matrix is the shorthand of <strong><em>Model</em></strong>, <strong><em>View</em></strong> and <strong><em>Projection</em></strong> matrices. Model matrix represents the 3d model’s transformation from object space to world space. View matrix represents the transformation of the 3d model from the world space to the camera(view) space. Projection(Clip) matrix represents the transformation of the 3d model from camera space to clip(screen) space.</p> <hr /> <h2 id="model">Model</h2> <p>Model matrix is used for the transformation of 3D Models from model space(also called object/local space) to the world space. It includes Translation, Rotation, and Scale. For more Detail see post <a href="https://gucheng0712.github.io/math/unity/csharp/2018/05/26/SRT-in-Matrix.html">Matrix SRT</a></p> <hr /> <h2 id="view">View</h2> <p>View matrix is used for the transformation of 3D Models from world space to view(camera) space. This is called <strong>view transformation</strong>. As we all known, there are two major coordinate system, right hand coordinate system, and left hand coordinate system. In Unity game engine, it uses left hand coordinate system, but in the view space, it will be coverted to left hand coordinate system.</p> <p align="center"> <img src="/static/assets/img/blog/camera_space.png" width="40%" /> </p> <p>In order to get the model’s position in view space, we can place the origin of the camera at the origin of the world coordinate. based on the Transform Component in above picture, the transformation of camera in world space order is rotate (30,0,0), then translate(0,10,-10). so in order to move the camera’s position back to the world origin, we need to do the inverse transformation, first translate(0,-10,10) then rotate(-30,0,0). we can get a matrix $M_{view^\prime}$</p> <p>\begin{equation} M_{view^\prime} = \begin{bmatrix} 1 &amp; 0 &amp; 0 &amp; 0 \\ 0 &amp; cos(-30) &amp; -sin(-30) &amp; 0 \\ 0 &amp; sin(-30) &amp; cos(-30) &amp; 0 \\ 0 &amp; 0 &amp; 0 &amp; 1 \end{bmatrix} \begin{bmatrix} 1 &amp; 0 &amp; 0 &amp; 0 \\ 0 &amp; 1 &amp; 0 &amp; -10 \\ 0 &amp; 0 &amp; 1 &amp; 10 \\ 0 &amp; 0 &amp; 0 &amp; 1 \end{bmatrix} \end{equation}</p> <p>However, due to the view space’s coordinate system is changed to right hand coordinate system , so we have to invert the z component by mulitply another matrix $M_{negatez}$</p> <p>\begin{equation} M_{view} = M_{negatez}M_{view^\prime} =<br /> \begin{bmatrix} 1 &amp; 0 &amp; 0 &amp; 0 \\ 0 &amp; 1 &amp; 0 &amp; 0 \\ 0 &amp; 0 &amp; -1 &amp; 0 \\ 0 &amp; 0 &amp; 0 &amp; 1 \end{bmatrix} M_{view^\prime} \end{equation}</p> <p>Finally, we can use this $M_{view}$ muiltiply the 3d model’s world position $P_{world} = (9,4,18.072,1)$ to get the 3d model’s position in view space $P_{view}$.</p> <p>\begin{equation} P_{view}^T = M_{view}P_{world}^T = M_{view} \begin{bmatrix} 9 \\ 4 \\ 18.072 \\ 1 \end{bmatrix} \end{equation}</p> <script type="math/tex; mode=display">P_{view} = (9, 4,18.072, 1)</script> <p><br /> <br /></p> <hr /> <h2 id="projection">Projection</h2> <p>Projection matrix is also called clip matrix which is used for the transformation of 3D Models from view space to clip space, then perform standard homogeneous division, also known as perspective division to get the Normalized Device Coordinates(NDC). Finally project on to screen which is known as screen space. Different from view space, the screen space is a 2-Dimensional space.</p> <p>The goal of clip space is to clip the render objects based on the <strong>view frustum</strong>. everything inside this view frustum will be rendered onto screen, others will be clipped. There are 2 types of Projection, one is Perspective projection, another is orthographic projection(shown in below image).</p> <p align="center"> <img src="/static/assets/img/blog/camera_projection.png" width="70%" /> </p> <hr /> <h3 id="1-perspective-projection">1. Perspective Projection</h3> <p>Perspective projection is characterized by the near large far small. There are 4 input parameters in perspective projection, Field of View(FOV), Aspect, Near , and Far.</p> <p align="center"> <img src="/static/assets/img/blog/perspective_projection_frustum.png" width="30%" /> </p> <p>The purpose of perspective projection is to transform the view frustum into a cuboid for eaier clipping. After the transformation, the upper right corner of the near clipping plane of the view frustum will become the center of the front plane of the cuboid. This is known as Normalized Device Coordinates(NDC)</p> <p>As can be seen from below figure, the transformation process is to enlarge the smaller part and shrink the larger part to form the final cuboid. That’s why the projection transformation is going to have a smaller effect.The x-coordinate range after transformation is [-1, 1], the y-coordinate range is [-1, 1], and the z-coordinate range is [-1, 1] (DirectX is slightly different, and the z-value range is [0, 1]).</p> <p align="center"> <img src="/static/assets/img/blog/perspectivet_ransformation.png" width="50%" /> </p> <p>Based on above infomation, we can get the perpective projection matrix $M_{frustum}$.</p> <p>\begin{equation} M_{persp} = \begin{bmatrix} \frac{cot\frac{FOV}{2}}{Aspect} &amp; 0 &amp; 0 &amp; 0 \\ 0 &amp; cot\frac{FOV}{2} &amp; 0 &amp; 0 \\ 0 &amp; 0 &amp; -\frac{Far+Near}{Far-Near} &amp; -\frac{2\cdot Near\cdot Far}{Far-Near} \\ 0 &amp; 0 &amp; -1 &amp; 0 \end{bmatrix} \end{equation}</p> <p>Then we can get $P_{clip}$ by multiply $P_{view}$.</p> <script type="math/tex; mode=display">P_{clip} = M_{persp}P_{view}</script> <p>For the derivation method, refer to the this <a href="https://www.cnblogs.com/graphics/archive/2012/07/25/2582119.html">Link</a></p> <hr /> <h3 id="2-orthographic-projection">2. Orthographic Projection</h3> <p>The view frustum of orthographic projection is a cuboid, so it will be easier to calculate the transformation matrix, M_{ortho}:</p> <p>\begin{equation} M_{ortho} = \begin{bmatrix} \frac{1}{Aspect\cdot Size} &amp; 0 &amp; 0 &amp; 0 \\ 0 &amp; \frac{1}{Size} &amp; 0 &amp; 0 \\ 0 &amp; 0 &amp; -\frac{2}{Far-Near} &amp; -\frac{Near+Far}{Far-Near} \\ 0 &amp; 0 &amp; 0 &amp; 1 \end{bmatrix} \end{equation}</p> <p>Then we can get $P_{clip}$ by multiply $P_{view}$.</p> <script type="math/tex; mode=display">P_{clip} = M_{ortho}P_{view}</script> <p>Similarly, we need to scale the orthogonal projection matrix’s x,y,z components to the range of <a href="In DirectX, z component's range is [0, 1]">-1, 1</a> become Normalized Device Coordinates(NDC).</p> <p align="center"> <img src="/static/assets/img/blog/orthographic_matrix.png" width="70%" /> </p> <hr /> <blockquote> <p><strong>End –Cheng Gu</strong></p> </blockquote> </div> <hr> <div class="row"> <div class="col-md-6"> <h5 style="display: inline;">Tags:</h5> <button class="btn btn-white btn-xs" type="button">Unity</button> <button class="btn btn-white btn-xs" type="button">Csharp</button> <button class="btn btn-white btn-xs" type="button">Math</button> <button class="btn btn-white btn-xs" type="button">CG</button> </div> <div class="col-md-6"> <div class="small text-right"> <div> </div> </div> </div> </div> <br> <div class="row"> <div class="col-lg-12"> <!-- donate --> <br> <!-- share --> <div class="a2a_kit a2a_kit_size_32 a2a_default_style"> <a class="a2a_dd" href="https://www.addtoany.com/share"></a> <a class="a2a_button_facebook"></a> <a class="a2a_button_twitter"></a> <a class="a2a_button_google_plus"></a> <a class="a2a_button_linkedin"></a> <a class="a2a_button_email"></a> <a class="a2a_button_wechat"></a> <a class="a2a_button_sina_weibo"></a> <a class="a2a_button_pocket"></a> </div> <script> var a2a_config = a2a_config || {}; a2a_config.color_main = "D7E5ED"; a2a_config.color_border = "AECADB"; a2a_config.color_link_text = "333333"; a2a_config.color_link_text_hover = "333333"; </script> <script async src="https://static.addtoany.com/menu/page.js"></script> <br> <!-- comment --> </div> </div> </div> </div> </div> </div> </div> <!-- Google analytics --> <!-- GrowingIO --> </body> </html>
